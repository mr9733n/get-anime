# Player DB Sync Merge Utility 0.0.0.1

### 8.33 New sync DB 
#### A. Транспорт и безопасность
- [x] Сквозное шифрование (X25519 + HKDF + NaCl SecretBox), направленные ключи, SAS, TOFU-хранилище (атомично, с fsync).
- [x] Чанковая передача с ACK, итоговый SHA-256, атомарная запись на приёмнике (`.tmp` → `os.replace`).
- [x] mDNS: объявление/поиск, корректный unreg при стопе, подбор реального IPv4.
- [+] «Проверить соединение» с таймаутом/ретраями и подсказками (порт, фаервол). *(базовый есть, доработать UX/тексты ошибок)*
- [x] Троттлинг скорости (лимит КБ/c) — опция в GUI.
- [x] Перезапуск приёмника при сбое mDNS/сокета (авто-рестарт).
- [x] Резюмируемая отправка (resume from offset): сверка размера/хеша снапшота и докачка недостающих чанков.
- [x] Доп. контроль целостности на каждый чанк (CRC32/sha256) + перезапрос конкретных чанков.
- [x] Опциональное сжатие (gzip) на лету для SQLite-снапшота.

#### B. GUI/UX
- [x] Вкладки: Send / Receive / Merge / Logs; крупный SAS в обеих; индикатор статуса сервера (красный/зелёный).
- [x] История адресов/портов (~/.player_db_gui.json); автоскролл логов; метки времени.
- [x] Тихие логи (агрегаты), сводка по таблицам всегда; компактный вывод FK-violations (топ-10).
- [+] mDNS-список приёмников в выпадающем списке (есть скан; добить автo-обновление и «Очистить/Обновить»).
- [x] Кнопки «Сохранить лог» и «Очистить лог».
- [x] Кнопка «Сбросить доверие (TOFU)» для выбранного хоста.
- [x] Настройки: лимит скорости, размер чанка, опция сжатия, флаги merge (см. ниже) — сохранять в конфиг.
- [x] Вывод всех сообщений в логи
- [x] Чекбокс compress gzip при отправке
- [x] Чекбокс VACUUM при отправке

#### C. Merge (логика и целостность)
- [x] Мёрдж по «естественным» ключам: `episodes.uuid`, `torrents.hash`; **никогда** не переписывать локальные `episode_id/torrent_id`.
- [x] `history`: резолв `episode_id` через `uuid`, `torrent_id` через `hash`; пропуск сирот с логом.
- [x] `schedule/production_studios/posters/franchise_releases`: `ensure_title_in_dst(...)`; щадящий пропуск сирот; `posters` — дедуп по `(title_id, hash_value)`, insert без `poster_id`.
- [x] Умный мёрдж `franchise_releases` по смысловому ключу, без переноса суррогатного `id`.
- [x] Итоговый отчёт: число пропущенных по каждой таблице + экспорт CSV «сироты/дубликаты».
- [x] Чекбоксы в GUI Merge: 
      
      1. «Пропускать постеры без hash»
      2. «Нормализовать дни недели (0..6→1..7)» *(дефолт: выкл, на случай неконсистентных источников)*
      3. «Skip orphans» (поведение по умолчанию уже щадящее — оставить как опцию).
- [x] `PRAGMA optimize`/`VACUUM` после большого мержа (по чекбоксу).

#### D. Сборка/релиз
- [x] Новый entry-point `db_sync_gui.py`; старые `sync/merge_utility` исключить из spec/бандла.
- [+] PyInstaller spec: `zeroconf`, `nacl` в hiddenimports; иконка/версия/имя EXE.
- [x] Post-install подсказка про Windows Firewall (вход на выбранный порт).

### 8.34 New sync DB «Через интернет»
#### Internet (TCP + STUN/UPnP)
- [x] использовать текущий TCP протокол
- [x] Режим «Internet» в GUI (переключатель Receive)
- [x]  STUN-детектор внешнего IP (pystun3), отображение адреса и порта
- [x] UPnP / NAT-PMP автопроброс (miniupnpc); результат в логах
- [x] Кнопка «Проверить доступность» (таймаут, диагностика)
- [x] Абстрактный TransportBase
- [x] Реализация TCPTransport
- [ ] Ограничение источников по IP / rate-limit

#### WebRTC (DataChannel)
- [x] WebRTCTransport — ядро (offer/answer, ICE, DataChannel) есть.
- [x] GUI: офлайн-сигналинг (Offer/Answer) есть.
- [x] Индикатор ICE есть (states в логах и label).
- [+] Логика fallback к TCP
- [x] GUI: Отобразить компактно в два столбца по смыслу, add scroll
- [x] Pretty Gui
- [x] Split in 2 version LAN and Inet
- [x] Fix transport for LAN version
- [x] Fix shutdown
- [x] Add **Отправитель (WebRTCSenderTransport):**
- [x] Add **Приёмник (WebRTCReceiverCore + GUI):** 
- [+] Добить мелкую косметику (например, текст заголовков/подсказок под каждый режим)
- [x] Fix Delete snapshot
- [x] WebRTC. Fix send more than 1 time  
- [x] после отправки мы не сбрасываем состояние подсказок
- [x] после Приемки мы не сбрасываем состояние подсказок
- [x] после Приемки не очищаем блоки с Offer/Answer

# Player DB Sync Merge Utility 0.0.0.2

### 8.35 Refactoring
- [ ] Split logic im moduls (managers) from db_sync_gui
- [ ] 

# Player DB Sync Merge Utility 0.0.0.3

### 8.36 New features
- [ ] если нажать clear и попробовать отправить бд еще раз то офер не сформируется, то и с ответом
- [ ] Cancel Send
- [ ] Cancel Receive
- [ ] Тест-кнопка «ICE connected?» с логом статусов
- [ ] Тестирование разных NAT/CGNAT сценариев
- [ ] expand offer/answer data. показывать свернутым по умолчанию
- [ ] формировать QR code for offer/answer
- [ ] Отправка Offer/Answer по почте (Postmark): текст + QR в приложении (PNG).
- [ ] Шифрование Offer/Answer перед QR/почтой:
      - либо X25519 + NaCl SecretBox (как в TCP-режиме),
      - либо простая парольная схема (SAS / passphrase) с локальным вводом.
- [ ] Загрузка Offer/Answer из QR (импорт PNG из письма / файла).
- [ ] При выборе WebRTC:
      - дизейблить блок Internet TCP mode (серым),
      - по возможности отключать несвязанные элементы (скорость/лимит порта),
      - в хинтах явно показывать, что используется офлайн-сигналинг.
